{"version":3,"sources":["webpack:///./src/views/WechatTest.vue?f802","webpack:///./src/views/WechatTest.vue","webpack:///./src/views/WechatTest.vue?e430","webpack:///./src/views/WechatTest.vue?79e4","webpack:///./src/lib/bridge.ts","webpack:///./src/lib/LoadScript.ts"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticRenderFns","LoadScript","win","window","app","uid","db","init_result","cloudbase_login","init","appid","resourceAppid","resourceEnv","scope","doLogin","then","res","code","info","msg","database","useJSSDK","console","log","wx","hideAllNonBaseMenuItem","showMenuItems","menuList","share","Title","Desc","Url","location","href","Img","ready","updateAppMessageShareData","title","desc","link","imgUrl","updateTimelineShareData","onMenuShareTimeline","success","onMenuShareAppMessage","alert","component","cloudapi","wxapi","JsBridgeReady","Promise","resolve","WeixinJSBridge","document","addEventListener","JsBridgeCloseMenu","call","LoadCloudApi","LoadWxApi","url","attr","type","reject","scriptElement","createElement","e","body","removeChild","Object","keys","val","setAttribute","src","appendChild"],"mappings":"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","file":"static/js/chunk-b7a703a2.f3f6a81b.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div')}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","\n\n\n\n\r\nimport { LoadCloudApi, LoadWxApi } from '@/lib/bridge';\r\nimport { LoadScript } from '@/lib/LoadScript';\r\nimport { Component, Vue, Watch } from 'vue-property-decorator';\r\n\r\n@Component<WechatTest>({})\r\nexport default class WechatTest extends Vue {\r\n  async created() {\r\n    await LoadWxApi();\r\n    await LoadCloudApi();\r\n    await LoadScript('/wxh5.js');\r\n    const win = window as any;\r\n    win.app = null;\r\n    win.uid = null;\r\n    win.db = null;\r\n    const init_result = win.cloudbase_login.init({\r\n      appid: 'wxc5709bd44205e738',\r\n      resourceAppid: 'wx647b8a5ba3cae7fa',\r\n      resourceEnv: 'fmex-i1c20',\r\n      scope: 'snsapi_base', // 登录方式：snsapi_userinfo snsapi_base\r\n    });\r\n\r\n    if (init_result) {\r\n      //初始化状态，如果为true则继续登录\r\n      const do_result = win.cloudbase_login.doLogin().then((res: any) => {\r\n        //公众号登录执行函数\r\n        if (res.code === 0) {\r\n          // code=0则登录成功\r\n          win.app = res.info; //info可获取到云开发的实例\r\n          win.uid = res.msg; //msg可获取到用户的openid（临时功能）\r\n          win.db = win.app.database(); // 装载云开发数据库对象\r\n          // todo 登录成功后的业务\r\n          win.cloudbase_login\r\n            .useJSSDK(\r\n              win.app,\r\n              [\r\n                'onMenuShareTimeline', // 发送朋友圈权限\r\n                'onMenuShareAppMessage', // 分享好友权限\r\n                'hideAllNonBaseMenuItem', // 隐藏所有非基础菜单\r\n                'showMenuItems', // 显示菜单项\r\n                'updateAppMessageShareData',\r\n                'updateTimelineShareData',\r\n              ],\r\n              false\r\n            )\r\n            .then((res: any) => {\r\n              console.log(res); //传入实例云开发、获取的能力列表、是否开启调试，装载SDK过程\r\n              win.wx.hideAllNonBaseMenuItem();\r\n              win.wx.showMenuItems({\r\n                menuList: [\r\n                  'menuItem:share:appMessage', // 发送给朋友\r\n                  'menuItem:share:timeline', // 分享到朋友圈\r\n                ],\r\n              });\r\n              const share = {\r\n                Title: 'Title',\r\n                Desc: 'Desc',\r\n                Url: location.href,\r\n                Img: 'https://fmex.fun/favicon.png',\r\n              };\r\n              win.wx.ready(function() {\r\n                //启动监听，准备成功后自动触发\r\n                win.wx.updateAppMessageShareData({\r\n                  //更新分享给朋友的链接\r\n                  title: share.Title, // 分享标题\r\n                  desc: share.Desc, // 分享描述\r\n                  link: share.Url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致\r\n                  imgUrl: share.Img, // 分享图标\r\n                });\r\n                win.wx.updateTimelineShareData({\r\n                  //更新分享给朋友圈的链接\r\n                  title: share.Title, // 分享标题\r\n                  link: share.Url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致\r\n                  imgUrl: share.Img, // 分享图标\r\n                });\r\n\r\n                window.wx.onMenuShareTimeline({\r\n                  title: share.Title, // 分享标题\r\n                  desc: share.Desc,\r\n                  link: share.Url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致\r\n                  imgUrl: share.Img, // 分享图标\r\n                  success: async (res: any) => {\r\n                    console.log(res);\r\n                    // if (res.errMsg === 'shareTimeline:ok') return alert('分享成功');\r\n                  },\r\n                });\r\n                window.wx.onMenuShareAppMessage({\r\n                  title: share.Title, // 分享标题\r\n                  desc: share.Desc, // 分享描述\r\n                  link: share.Url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致\r\n                  imgUrl: share.Img, // 分享图标\r\n                  success: async (res: any) => {\r\n                    console.log(res);\r\n                    // if (res.errMsg === 'sendAppMessage:ok') return alert('分享成功');\r\n                  },\r\n                });\r\n              });\r\n            });\r\n        } else {\r\n          console.log(res.info);\r\n        }\r\n      });\r\n    } else {\r\n      //初始化状态，如果为false则无条件，需要引入cloud-sdk\r\n      alert('没有引入cloud-sdk');\r\n    }\r\n  }\r\n}\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WechatTest.vue?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--14-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/ts-loader/index.js??ref--14-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./WechatTest.vue?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./WechatTest.vue?vue&type=template&id=46a661b6&\"\nimport script from \"./WechatTest.vue?vue&type=script&lang=ts&\"\nexport * from \"./WechatTest.vue?vue&type=script&lang=ts&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { IsWechat } from './utils';\r\nimport { LoadScript } from '@/lib/LoadScript';\r\n\r\n// 声明window变量\r\ndeclare global {\r\n  interface Window {\r\n    AlipayJSBridge: any;\r\n    WeixinJSBridge: any;\r\n  }\r\n}\r\n\r\n/**\r\n * 等待微信支付宝SDK加载完毕\r\n */\r\nexport const JsBridgeReady = () => {\r\n  return new Promise((resolve) => {\r\n    if (IsWechat) {\r\n      if (typeof window.WeixinJSBridge !== 'undefined') return resolve();\r\n      return document.addEventListener('WeixinJSBridgeReady', resolve, false);\r\n    }\r\n    resolve();\r\n  });\r\n};\r\n\r\nexport const JsBridgeCloseMenu = async () => {\r\n  await JsBridgeReady();\r\n  if (IsWechat) {\r\n    window.WeixinJSBridge.call('hideOptionMenu');\r\n  }\r\n};\r\n\r\nlet cloudapi: any;\r\nexport const LoadCloudApi = async () => {\r\n  if (cloudapi) return cloudapi;\r\n  cloudapi = LoadScript('https://res.wx.qq.com/open/js/cloudbase/1.1.0/cloud.js');\r\n  return cloudapi;\r\n};\r\n\r\nlet wxapi: any;\r\nexport const LoadWxApi = async () => {\r\n  if (wxapi) return wxapi;\r\n  wxapi = LoadScript('https://res.wx.qq.com/open/js/jweixin-1.6.0.js');\r\n  return wxapi;\r\n};\r\n","export const LoadScript = (\r\n  url: string,\r\n  attr: {\r\n    [index: string]: string;\r\n  } = {\r\n    type: 'text/javascript',\r\n  }\r\n) => {\r\n  return new Promise((resolve, reject) => {\r\n    const scriptElement = document.createElement('script');\r\n\r\n    scriptElement.addEventListener(\r\n      'load',\r\n      (e) => {\r\n        document.body.removeChild(scriptElement);\r\n        resolve(e);\r\n      },\r\n      false\r\n    );\r\n\r\n    scriptElement.addEventListener(\r\n      'error',\r\n      (e) => {\r\n        document.body.removeChild(scriptElement);\r\n        reject(e);\r\n      },\r\n      false\r\n    );\r\n\r\n    if (attr) {\r\n      for (const val of Object.keys(attr)) {\r\n        scriptElement.setAttribute(val, attr[val]);\r\n      }\r\n    }\r\n\r\n    scriptElement.src = url;\r\n    document.body.appendChild(scriptElement);\r\n  });\r\n};\r\n"],"sourceRoot":""}